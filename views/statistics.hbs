<!-- Page showing statistics for selected test -->

<div class="container" id="statistics">
    <div class="col-lg-10 col-lg-offset-1">
        <div class="row">
            <div class="col-lg-12">
                <h1 class="title">Statistik</h1>
            </div>
        </div>
        <hr>
        <div class="panel panel-default">
              <div class="panel-heading">
                    <h1 class="panel-title">Statistik</h1>
              </div>
              <div class="panel-body">

                  <!-- Test selection -->
                  <h4>Välj test för att se statistik</h4><br>
                  <form action="/test" method="get">
                      <select name="test" id="testSelect" class="form-control">
                          <option hidden id="defaultTestOption" value="hopp">Välj prov</option>
                          {{#each tests}}
                              <option class="{{this.TestId}}">{{this.TTitle}}</option>
                          {{/each}}
                      </select>
                      <select name="group" id="groupSelect" class="form-control">
                          <option hidden id="defaultGroupOption">Välj grupp...</option>
                          {{#each group}}
                              <option class="{{this.StudentGroupId}}">{{this.groupName}}</option>
                          {{/each}}
                      </select><br>
                      <button type="button" class="btn btn-primary" id="statsButton">Se statistik</button>
                  </form>
                
                    <div class="col-lg-4 col-lg-offset-4">
                  <table class="table" id="info"></table>
                    </div>

                  <!-- Displaying statistics -->
                  <table class="table" id="statsTable"></table>

              </div>
        </div>
    </div>
</div>

<script>

    $("#groupSelect").prop('disabled', true);
    $("#statsButton").prop('disabled', true);
        {{#statsObject}}


        $("#info").html(`
            <tr>
                <th><h2>Test</h2></th>
                <th><h2>Grupp</h2></th>
            </tr>
            <tr>
                <td>{{TTitle}}</td>
                <td>{{groupName}}</td>
            </tr>
        `);

            var min = 0;
            var sec = {{ATTimeSecAvg}};
            while(sec >= 60){
                sec -= 60;
                min++;
            }

            $("#statsTable").empty();
            $("#statsTable").html(`
                    <br>
                    <tr>
                        <th>Genomförda test <span class="label label-success">Totalt antal</span></th>
                        <td id="totAnsweredTests">{{ATUserIdCount}}</td>
                    </tr>
                    <tr>
                        <th>Godkända resultat <span class="label label-success">Totalt antal</span></th>
                        <td id="totPassedTests">{{ATGradeCount}}</td>
                    </tr>
                    <tr>
                        <th>Poäng <span class="label label-primary">Medelvärde</span></th>
                        <td id="avgPoints">{{ATPointsAvg}} (Maxpoäng: {{TMaxPoints}})</td>
                    </tr>
                    <tr>
                        <th>Tidåtgång <span class="label label-primary">Medelvärde</span></th>
                        <td id="avgTime">`+ min +` minuter `+ sec +` sekunder</td>
                    </tr>
        `       );
        {{/statsObject}}

        $("#statsTable").slideDown();


        $("select#testSelect").on("change", function() {
            $("#groupSelect").prop('disabled', false);
        });
        $("select#groupSelect").on("change", function() {
            $("#statsButton").prop('disabled', false);
        });


    $(document).on('click', '#statsButton', function() {
        var currTestId = $('#testSelect :selected').attr('class');
        var currGroupId = $('#groupSelect :selected').attr('class');
        var currTTitle = $('#testSelect :selected').text();
        var currGroupName = $('#groupSelect :selected').text();

        var idData = {};
        idData.testId = currTestId;
        idData.tTitle = currTTitle;
        idData.groupId = currGroupId;
        idData.groupName = currGroupName;

        $.ajax({
            url: '/statistics',
            method: 'post',
            data: idData,
            success: function(){
                console.log('Yay');
                location.replace('statistics');
            }
        });




    });

</script>