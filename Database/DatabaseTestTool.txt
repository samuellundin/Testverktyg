

DROP  DATABASE TestTool;
CREATE DATABASE TestTool;
USE TestTool;

CREATE TABLE User(
		UserId INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
		FirstName VARCHAR(20) NOT NULL,
		LastName VARCHAR(20) NOT NULL,
		Mail VARCHAR(50) UNIQUE NOT NULL,
		Password VARCHAR(200) NOT NULL,
		Role VARCHAR(30) NOT NULL
		);

CREATE TABLE Test(
		TestId INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
		TUserId INT,
		TTitle VARCHAR(200) NOT NULL UNIQUE,
        TStartTestDate DATETIME,
		TEndTestDate DATETIME,
		TTimeMin INT(10) NOT NULL,
		TMaxPoints INT(10) NOT NULL,
		TSelfCorrecting TINYINT(1) NOT NULL,
		CONSTRAINT TUserIdFK FOREIGN KEY (TUserId) REFERENCES User(UserId)
		);

CREATE TABLE Questions(
		QuestionId INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
		QTestId INT,
		Question VARCHAR(60) NOT NULL,
		QType VARCHAR(20) NOT NULL,
		QPoints INT(10) NOT NULL,
		QOrder INT(10) NOT NULL,
		CONSTRAINT QTestIdFK FOREIGN KEY (QTestId) REFERENCES Test(TestId)
		);


CREATE TABLE Answers(
		AnswersId INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
		AQuestionId INT,
		AOrder INT(10) NOT NULL,
		APoints INT(10) NOT NULL,
		ACorrected BOOLEAN NOT NULL,
		AText VARCHAR(60) NOT NULL,
		CONSTRAINT AQuestionIdFK FOREIGN KEY (AQuestionId) REFERENCES Questions(QuestionId)
		);

CREATE TABLE AnsweredTest(
		AnsweredTestId INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
		ATestId INT,
		ATUserId INT,
		ATDate DATE NOT NULL,
		ATCorrected BOOLEAN NOT NULL,
		ATPoints INT(10) NOT NULL,
                ATTimeMin INT(10) NOT NULL,
		ATGrade VARCHAR(10) NOT NULL,
		CONSTRAINT ATAnswersIdFK FOREIGN KEY (ATestId) REFERENCES Test(TestId),
		CONSTRAINT UAUserIdFK FOREIGN KEY (ATUserId) REFERENCES User(UserId)
		);

CREATE TABLE AnsweredQuestion(
		AnsweredQuestionId INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
		AQQuestionId INT,
		AQAnsweredTestId INT,
		UAPoints TINYINT(1) NOT NULL,
		CONSTRAINT AQQuestionIdFK FOREIGN KEY (AQQuestionId) REFERENCES Questions(QuestionId),
		CONSTRAINT AQAnsweredTestIdFK FOREIGN KEY (AQAnsweredTestId) REFERENCES AnsweredTest(AnsweredTestId)
		);

CREATE TABLE UserAnswer(
		UserAnswerId INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
		UAQuestionId INT,
		UAAnswersId INT,
		UAOrder INT(1) NOT NULL,
		UAText VARCHAR(500),
		CONSTRAINT UAQuestionIdFK FOREIGN KEY (UAQuestionId) REFERENCES AnsweredQuestion(AnsweredQuestionId),
		CONSTRAINT UAAnswersIdFK FOREIGN KEY (UAAnswersId) REFERENCES Answers(AnswersId)
		);

CREATE TABLE StudentGroup(
      StudentGroupId INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
      groupName VARCHAR(50)
    );

CREATE TABLE GroupDetails(
       GroupDetailsId INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
       GDStudentGroupId INT,
       GDUserId INT,
       CONSTRAINT GDStudentGroupIdFK FOREIGN KEY (GDStudentGroupId) REFERENCES StudentGroup(StudentGroupId),
       CONSTRAINT GDUserIdFK FOREIGN KEY (GDUserId) REFERENCES User(UserId)
		);

CREATE TABLE TestComment(
TestCommentId INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
TestComment VARCHAR(60),
TCUserId INT,
TCATestId INT,
CONSTRAINT TCUserIdFK FOREIGN KEY (TCUserId) REFERENCES User(UserId),
CONSTRAINT TCATestIdFK FOREIGN KEY (TCATestId) REFERENCES AnsweredTest(ATestId));

CREATE TABLE QuestionComment(
QuestionCommentId INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
QuestionComment VARCHAR (60),
QCUserId INT,
QCQuestionId INT,
CONSTRAINT QCUserIdFK FOREIGN KEY (QCUserId) REFERENCES User(UserId),
CONSTRAINT QCQuestionIdFK FOREIGN KEY (QCQuestionId) REFERENCES Questions(QuestionId));

